---
layout: post
title: WPF Datagrid Items Refresh, part II
date: '2009-07-19T13:40:00.004-05:00'
author: Stephen Wrighton
tags:
- ".NET"
- programming
- Coding
- Windows
- WPF
modified_time: '2009-07-19T14:19:21.583-05:00'
blogger_id: tag:blogger.com,1999:blog-947968907697915479.post-2474110741818108701
blogger_orig_url: https://programmer.wrighton.org/2009/07/wpf-datagrid-items-refresh-part-ii.html
---

<!-- code formatted by http://manoli.net/csharpformat/ --><br /><style type="text/css"><br />.csharpcode, .csharpcode pre<br />{<br /> font-size: small;<br /> color: black;<br /> font-family: Consolas, "Courier New", Courier, Monospace;<br /> background-color: #ffffff;<br /> /*white-space: pre;*/<br />}<br /><br />.csharpcode pre { margin: 0em; }<br /><br />.csharpcode .rem { color: #008000; }<br /><br />.csharpcode .kwrd { color: #0000ff; }<br /><br />.csharpcode .str { color: #006080; }<br /><br />.csharpcode .op { color: #0000c0; }<br /><br />.csharpcode .preproc { color: #cc6633; }<br /><br />.csharpcode .asp { background-color: #ffff00; }<br /><br />.csharpcode .html { color: #800000; }<br /><br />.csharpcode .attr { color: #ff0000; }<br /><br />.csharpcode .alt <br />{<br /> background-color: #f4f4f4;<br /> width: 100%;<br /> margin: 0em;<br />}<br /><br />.csharpcode .lnum { color: #606060; }<br /></style>Back in January, I posted a <a href="http://programmer.wrighton.org/2009/01/wpf-datagrid-items-refresh.html">short entry about refreshing the datagrid in WPF</a>.  Which has gotten a number of questions regarding it. Well, one from Mykhaylo Khodorev made me go look some more into it.   Apparently, the use of a generic IEnumerable object was failing this little trick.  First, some information I've learned since then.<br /><br />If the collection you're using to assign to the ItemSource attribute of your datagrid is an ObservableCollection (or inherits from it) any changes to the collection are automatically propagated to the grid.  Secondly, the process described works while using a Generic List<t> collection.<br /><br />But, just so that we're clear on exactly what's happening, I'm placing my code that I used here.  So here's the XAML:<blockquote><br /><pre class="csharpcode"><br /><span class="kwrd">&lt;</span><span class="html">Window</span> <span class="attr">x:Class</span><span class="kwrd">="Window1"</span><br /><span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span><br /><span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span><br />    <span class="attr">xmlns:wpftk</span><span class="kwrd">="http://schemas.microsoft.com/wpf/2008/toolkit"</span><br /><span class="attr">Title</span><span class="kwrd">="Window1"</span> <span class="attr">Height</span><span class="kwrd">="300"</span> <span class="attr">Width</span><span class="kwrd">="300"</span> <span class="attr">Initialized</span><span class="kwrd">="Window_Initialized"</span> <span class="kwrd">&gt;</span><br /><span class="kwrd">&lt;</span><span class="html">DockPanel</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;</span><span class="html">StackPanel</span> <span class="attr">Orientation</span><span class="kwrd">="Horizontal"</span> <span class="attr">DockPanel</span>.<span class="attr">Dock</span><span class="kwrd">="Top"</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;</span><span class="html">TextBox</span> <span class="attr">Name</span><span class="kwrd">="txtAddItem"</span> <span class="attr">Width</span><span class="kwrd">="50"</span> <span class="attr">MaxWidth</span><span class="kwrd">="50"</span>  <span class="kwrd">/&gt;</span><br />    <span class="kwrd">&lt;</span><span class="html">Button</span> <span class="attr">Name</span><span class="kwrd">="btnAddItem"</span> <span class="attr">Content</span><span class="kwrd">="Add Item"</span> <span class="attr">Click</span><span class="kwrd">="btnAddItem_Click"</span><br />            <span class="attr">HorizontalAlignment</span><span class="kwrd">="Right"</span> <span class="kwrd">/&gt;</span><br />        <span class="kwrd">&lt;</span><span class="html">Button</span> <span class="attr">Name</span><span class="kwrd">="btnRefresh"</span> <span class="attr">Content</span><span class="kwrd">="Refresh"</span> <span class="attr">HorizontalAlignment</span><span class="kwrd">="Right"</span> <span class="attr">Click</span><span class="kwrd">="btnRefresh_Click"</span> <span class="kwrd">/&gt;</span><br />        <span class="kwrd">&lt;/</span><span class="html">StackPanel</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;</span><span class="html">Grid</span><span class="kwrd">&gt;</span><br />        <span class="kwrd">&lt;</span><span class="html">Grid.ColumnDefinitions</span> <span class="kwrd">&gt;</span><br />            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="1*"</span> <span class="kwrd">/&gt;</span><br />            <span class="kwrd">&lt;</span><span class="html">ColumnDefinition</span> <span class="attr">Width</span><span class="kwrd">="1*"</span> <span class="kwrd">/&gt;</span><br />        <span class="kwrd">&lt;/</span><span class="html">Grid.ColumnDefinitions</span><span class="kwrd">&gt;</span><br />        <span class="kwrd">&lt;</span><span class="html">wpftk:DataGrid</span> <span class="attr">Name</span><span class="kwrd">="xGridObservableCollection"</span> <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="0"</span> <span class="attr">AutoGenerateColumns</span><span class="kwrd">="False"</span><span class="kwrd">&gt;</span><br />            <span class="kwrd">&lt;</span><span class="html">wpftk:DataGrid.Columns</span><span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;</span><span class="html">wpftk:DataGridTextColumn</span> <span class="attr">Header</span><span class="kwrd">="Item"</span> <span class="attr">Binding</span><span class="kwrd">="{Binding Item}"</span> <span class="attr">IsReadOnly</span><span class="kwrd">="True"</span> <span class="kwrd">/&gt;</span><br />            <span class="kwrd">&lt;/</span><span class="html">wpftk:DataGrid.Columns</span><span class="kwrd">&gt;</span><br />        <span class="kwrd">&lt;/</span><span class="html">wpftk:DataGrid</span><span class="kwrd">&gt;</span><br />    <br />        <span class="kwrd">&lt;</span><span class="html">wpftk:DataGrid</span> <span class="attr">Name</span><span class="kwrd">="xGridList"</span> <span class="attr">Grid</span>.<span class="attr">Column</span><span class="kwrd">="1"</span> <span class="attr">AutoGenerateColumns</span><span class="kwrd">="False"</span><span class="kwrd">&gt;</span><br />            <span class="kwrd">&lt;</span><span class="html">wpftk:DataGrid.Columns</span><span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;</span><span class="html">wpftk:DataGridTextColumn</span> <span class="attr">Header</span><span class="kwrd">="Item"</span> <span class="attr">Binding</span><span class="kwrd">="{Binding Item}"</span> <span class="attr">IsReadOnly</span><span class="kwrd">="True"</span> <span class="kwrd">/&gt;</span><br />            <span class="kwrd">&lt;/</span><span class="html">wpftk:DataGrid.Columns</span><span class="kwrd">&gt;</span><br />        <span class="kwrd">&lt;/</span><span class="html">wpftk:DataGrid</span><span class="kwrd">&gt;</span><br />    <span class="kwrd">&lt;/</span><span class="html">Grid</span><span class="kwrd">&gt;</span><br /><span class="kwrd">&lt;/</span><span class="html">DockPanel</span><span class="kwrd">&gt;</span><br /><span class="kwrd">&lt;/</span><span class="html">Window</span><span class="kwrd">&gt;</span><br /></pre></blockquote><br />And here's the VB.Net CodeBehind for that XAML:<blockquote><br /><pre class="csharpcode"><br /><span class="kwrd">Imports</span> System.Collections.ObjectModel<br /><br /><span class="kwrd">Class</span> Window1<br /><br /> <span class="kwrd">Private</span> <span class="kwrd">Sub</span> btnAddItem_Click(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> System.<span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> System.Windows.RoutedEventArgs)<br />     <span class="kwrd">Dim</span> x <span class="kwrd">As</span> <span class="kwrd">String</span> = <span class="kwrd">Me</span>.txtAddItem.Text<br />     <span class="kwrd">Dim</span> b <span class="kwrd">As</span> <span class="kwrd">New</span> ItemClass(x)<br />     _itemList.Add(b)<br />     _items.Add(b)<br /> <span class="kwrd">End</span> <span class="kwrd">Sub</span><br /><br /> <span class="kwrd">Private</span> _items <span class="kwrd">As</span> <span class="kwrd">New</span> Items<br /> <span class="kwrd">Private</span> _itemList <span class="kwrd">As</span> <span class="kwrd">New</span> List(Of ItemClass)<br /><br /> <span class="kwrd">Private</span> <span class="kwrd">Sub</span> Window_Initialized(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> System.<span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> System.EventArgs)<br /><br />     <span class="kwrd">Dim</span> x <span class="kwrd">As</span> <span class="kwrd">Integer</span> = 0<br />     <span class="kwrd">Do</span> <span class="kwrd">While</span> x &lt; 5<br />         <span class="kwrd">Dim</span> i <span class="kwrd">As</span> <span class="kwrd">New</span> ItemClass(<span class="str">"Auto Gen Item # "</span> &amp; x)<br />         i.Value = x<br />         _itemList.Add(i)<br />         _items.Add(i)<br /><br />         x += 1<br />     <span class="kwrd">Loop</span><br />     <span class="kwrd">Me</span>.xGridList.ItemsSource = _itemList<br />     <span class="kwrd">Me</span>.xGridObservableCollection.ItemsSource = _items<br /> <span class="kwrd">End</span> <span class="kwrd">Sub</span><br /><br /> <span class="kwrd">Private</span> <span class="kwrd">Sub</span> btnRefresh_Click(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> System.<span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> System.Windows.RoutedEventArgs)<br />     <span class="kwrd">Me</span>.xGridList.Items.Refresh()<br /> <span class="kwrd">End</span> <span class="kwrd">Sub</span><br /><span class="kwrd">End</span> <span class="kwrd">Class</span><br /><br /><span class="kwrd">Public</span> <span class="kwrd">Class</span> ItemClass<br /> <span class="kwrd">Implements</span> System.ComponentModel.INotifyPropertyChanged<br /><br /> <span class="kwrd">Private</span> _v <span class="kwrd">As</span> <span class="kwrd">Integer</span><br /> <span class="kwrd">Public</span> <span class="kwrd">Property</span> Value() <span class="kwrd">As</span> <span class="kwrd">Integer</span><br />     <span class="kwrd">Get</span><br />         <span class="kwrd">Return</span> _v<br />     <span class="kwrd">End</span> <span class="kwrd">Get</span><br />     <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> <span class="kwrd">Integer</span>)<br />         _v = value<br />         OnPropertyChanged(<span class="str">"Value"</span>)<br />     <span class="kwrd">End</span> <span class="kwrd">Set</span><br /> <span class="kwrd">End</span> <span class="kwrd">Property</span><br /> <span class="kwrd">Private</span> _item <span class="kwrd">As</span> <span class="kwrd">String</span><br /> <span class="kwrd">Public</span> <span class="kwrd">Property</span> Item() <span class="kwrd">As</span> <span class="kwrd">String</span><br />     <span class="kwrd">Get</span><br />         <span class="kwrd">Return</span> _item<br />     <span class="kwrd">End</span> <span class="kwrd">Get</span><br />     <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> <span class="kwrd">String</span>)<br />         _item = value<br />         OnPropertyChanged(<span class="str">"Item"</span>)<br />     <span class="kwrd">End</span> <span class="kwrd">Set</span><br /> <span class="kwrd">End</span> <span class="kwrd">Property</span><br /><br /> <span class="kwrd">Public</span> <span class="kwrd">Sub</span> <span class="kwrd">New</span>(<span class="kwrd">ByVal</span> itemtext <span class="kwrd">As</span> <span class="kwrd">String</span>)<br />     _item = itemtext<br /> <span class="kwrd">End</span> <span class="kwrd">Sub</span><br /><br /> <span class="kwrd">Protected</span> <span class="kwrd">Overridable</span> <span class="kwrd">Sub</span> OnPropertyChanged(<span class="kwrd">ByVal</span> propertyName <span class="kwrd">As</span> <span class="kwrd">String</span>)<br />     <span class="kwrd">Dim</span> e <span class="kwrd">As</span> <span class="kwrd">New</span> System.ComponentModel.PropertyChangedEventArgs(propertyName)<br />     <span class="kwrd">RaiseEvent</span> PropertyChanged(<span class="kwrd">Me</span>, e)<br /> <span class="kwrd">End</span> <span class="kwrd">Sub</span><br /> <span class="kwrd">Public</span> <span class="kwrd">Event</span> PropertyChanged(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> <span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> System.ComponentModel.PropertyChangedEventArgs) <span class="kwrd">Implements</span> System.ComponentModel.INotifyPropertyChanged.PropertyChanged<br /><span class="kwrd">End</span> <span class="kwrd">Class</span><br /><br /><span class="kwrd">Public</span> <span class="kwrd">Class</span> Items<br /> <span class="kwrd">Inherits</span> ObservableCollection(Of ItemClass)<br /><span class="kwrd">End</span> Class</pre></blockquote><br />Now, please realize that this is not 100% perfect (or production worthy) code, but rather stuff I tossed together for the provenance of this point.<br /><br />What I've done is built a WPF application which holds two grids, one whose ItemsSource is pointed towards an ObservableCollection<t> while the other's ItemsSource looks at a List<t>. This is to show that when new items are added to these collections, one will automatically update while the other requires an explicit call to the datagrid's Items collection in order for the UI to be updated.<br /><br />Now if you go back and look at Mykhaylo's code in the comment posted, you'll notice that the values are being populated via an IEnumerable accessed via a LINQ query of a DataTable in a DataSet.<br /><br />Additionally, when Mykhaylo adds new items to the datatable, it appears in the datatable but not in the datagrid.<br /><br />There's a reason for this.<br /><br />And that is because the datagrid and the datatable are not bound together.<br /><br />Here is mykhaylo's code: </t></t></t><blockquote>AccDataGrid.ItemsSource =   from account in _myDataSet.Accounts   select new Account(account);</blockquote>Notice that what's happening is that Mykhaylo is basically using LINQ to generate a new List which only exists as an object in the Datagrid's ItemsSource property.<br /><br />Therefore when new items are added to the _myDataSet.Accounts object, there's nothing anywhere telling the datagrid about those objects.  <br /><br />The easiest solution would be to bind the datagrid in this manner: <blockquote>AccDatagrid.ItemsSource = _myDataSet.Accounts</blockquote> Then when items are added to the Accounts datagrid, it becomes a simple matter of using the AccDataGrid.Items.Refresh() command to update the UI.