---
layout: post
title: Sometimes, I'm too smart for my own good....
date: '2007-06-18T12:47:00.000-05:00'
author: Stephen Wrighton
tags:
- ".NET"
- Oracle
- Coding
modified_time: '2007-06-18T13:01:00.891-05:00'
blogger_id: tag:blogger.com,1999:blog-947968907697915479.post-2162094319337990490
blogger_orig_url: https://programmer.wrighton.org/2007/06/sometimes-im-too-smart-for-my-own-good.html
---

I have an application, and it's common practice to build our applications with external data layers, that implement an interface, utilizing common data types and interfaces to send data back and forth. One common one is the IDataReader.<br /><br />Well, I have this web application that I built - the one running the Oracle database - and we kept getting either a TNS Listener error or Connection Timeout errors. Frankly, I'm of the opinion that they're the same error, it's just that some are getting reported out of the .NET native OracleClient classes (which I utilized) and some are getting reported out of Oracle's implementation of the same (which my co-worker utilized).<br /><br />Anyways, we kept getting these errors, which resolved down to the connection pool was getting filled up with connections.  Bad for business to say the least.<br /><br />What it ended up being, was we had forgotten a parameter on the Command.ExecuteReader function.<br /><br />Normally, you don't need to pass in any parameters to this function, as most people use it directly there in the code with the connection and command objects, so they can destroy them all at the same time.<br /><br />The problem comes in with the fact that since we're passing the DataReader out of the method which generates it, so it can be used elsewhere, we can't close down or destroy the connection and command objects as that would destroy the DataReader as well.<br /><br />Which is where that parameter comes in.<br /><br />It's called the <span style="font-weight: bold;">CommandBehavior </span>enumeration, and it is used like this:<br /><blockquote><span style="color: rgb(0, 0, 153);">Function </span>GetValue <span style="color: rgb(0, 0, 153);">As </span>Data.IDataReader<br />&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 153);">Dim </span>comm <span style="color: rgb(51, 51, 255);"><span style="color: rgb(0, 0, 153);">As New</span> </span>OracleClient.OracleConnection<br />&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 0, 153);">Dim </span>conn <span style="color: rgb(0, 0, 153);">As New </span>OracleClient.OracleConnection<br />&nbsp;&nbsp;&nbsp;<span style="color: rgb(0, 102, 0);">' Snip Connection/Command stuff</span><br /><br />&nbsp;&nbsp;&nbsp;comm.CommandText = "EXEC MyPackage.StoredProcedure"<br />&nbsp;&nbsp;&nbsp;GetValue = comm.ExecuteReader(CommandBehavior.CloseConnection)<br /><span style="color: rgb(0, 0, 153);">End Function</span><br /></blockquote>Really, quite a simple solution when I remember to add it in. <br /><br />Anyways, the <span style="font-weight: bold;">CommandBehavior </span>enumeration has a couple different options, but as noted, the one we're interested in here, is the <span style="font-weight: bold;">CloseConnection </span>option. What this does is destroys the underlying connection and command objects of a DataReader when the DataReader itself is destroyed.<br /><br />And since I added it into the <span style="font-weight: bold;">ExecuteReader </span>calls in my data retrieval functions, the connection pool isn't being filled up, so I'm not getting all those errors.