---
layout: post
title: Ah... Data Templates, How I Love Thee....
date: '2009-08-07T06:06:00.001-05:00'
updated: "2019-03-07 19:46:00"
permalink: "/2009/08/ah-data-templates-how-i-love-thee.html"
author: Stephen Wrighton
tags:
- User Interface
- ".NET"
- programming
- Windows
- WPF
modified_time: '2009-08-07T09:06:55.800-05:00'
thumbnail: http://1.bp.blogspot.com/_0dC8-RtLatg/SnwzS3vHQLI/AAAAAAAAA5o/A-K2zb_rE3o/s72-c/addresslistapp.png
blogger_id: tag:blogger.com,1999:blog-947968907697915479.post-3011994557427168688
blogger_orig_url: https://programmer.wrighton.org/2009/08/ah-data-templates-how-i-love-thee.html
---

<!-- code formatted by http://manoli.net/csharpformat/ --><br /><style type="text/css"><br />.csharpcode, .csharpcode pre<br />{<br /> font-size: small;<br /> color: black;<br /> font-family: Consolas, "Courier New", Courier, Monospace;<br /> background-color: #ffffff;<br /> /*white-space: pre;*/<br />}<br /><br />.csharpcode pre { margin: 0em; }<br /><br />.csharpcode .rem { color: #008000; }<br /><br />.csharpcode .kwrd { color: #0000ff; }<br /><br />.csharpcode .str { color: #006080; }<br /><br />.csharpcode .op { color: #0000c0; }<br /><br />.csharpcode .preproc { color: #cc6633; }<br /><br />.csharpcode .asp { background-color: #ffff00; }<br /><br />.csharpcode .html { color: #800000; }<br /><br />.csharpcode .attr { color: #ff0000; }<br /><br />.csharpcode .alt <br />{<br /> background-color: #f4f4f4;<br /> width: 100%;<br /> margin: 0em;<br />}<br /><br />.csharpcode .lnum { color: #606060; }<br /></style>What?  You don't like them?  Oh, but you will.... you will....<br /><br />WPF has a number of different Templates which can be applied to controls, and the DataTemplate is the one that's used for things like ListViews, ListBoxes and ComboBoxes.<br /><br />These things have great and wonderful powers.  I use them a lot--mainly when I'm trying to display complex data via a ListView--complex data such as a history of addresses for an entity.   Consider, an address has 4-8 fields of data associated with it: 2 or 3 Street lines, a city, a region, a postal code and possibly country and county data.  In addition to the data, I want to have command buttons  that allow me to perform EDIT/DELETE operations on that line of data.<br /><br />Now, in a traditional ListView, all I would have to do is bind to my Address class, and override the ToString function to return the data  in a single line, and the listview will display it.  For this particular example, I'll use the following as my Data Object:<!-- code formatted by http://manoli.net/csharpformat/ --><br /><pre class="csharpcode"><br /><span class="kwrd">public</span> <span class="kwrd">class</span> AddressViewModel : INotifyPropertyChanged<br />    {<br /><br />        <span class="kwrd">private</span> <span class="kwrd">string</span> _line1;<br />        <span class="kwrd">private</span> <span class="kwrd">string</span> _line2;<br />        <span class="kwrd">private</span> <span class="kwrd">string</span> _city;<br />        <span class="kwrd">private</span> <span class="kwrd">string</span> _state;<br />        <span class="kwrd">private</span> <span class="kwrd">string</span> _postal;<br /><br />        <span class="kwrd">public</span> <span class="kwrd">string</span> Line1<br />        {<br />            get { <span class="kwrd">return</span> _line1; }<br />            set { _line1 = <span class="kwrd">value</span>; onPropertyChanged(<span class="str">"Line1"</span>); }<br />        }<br />        <span class="kwrd">public</span> <span class="kwrd">string</span> Line2<br />        {<br />            get { <span class="kwrd">return</span> _line2; }<br />            set { _line2 = <span class="kwrd">value</span>; onPropertyChanged(<span class="str">"Line2"</span>); }<br />        }<br />        <span class="kwrd">public</span> <span class="kwrd">string</span> City<br />        {<br />            get { <span class="kwrd">return</span> _city; }<br />            set { _city = <span class="kwrd">value</span>; onPropertyChanged(<span class="str">"City"</span>); }<br />        }<br />        <span class="kwrd">public</span> <span class="kwrd">string</span> State<br />        {<br />            get { <span class="kwrd">return</span> _state; }<br />            set { _state = <span class="kwrd">value</span>; onPropertyChanged(<span class="str">"State"</span>); }<br />        }<br />        <span class="kwrd">public</span> <span class="kwrd">string</span> Postal<br />        {<br />            get { <span class="kwrd">return</span> _postal; }<br />            set { _postal = <span class="kwrd">value</span>; onPropertyChanged(<span class="str">"Postal"</span>); }<br />        }<br /><br />        <span class="kwrd">public</span> <span class="kwrd">string</span> AddressString<br />        {<br />            get {<br />                <span class="kwrd">string</span> s = <span class="str">""</span>;<br />                s = s + _line1;<br />                s = s + <span class="str">"\n"</span>;<br />                s = s + _city + <span class="str">", "</span> + _state + <span class="str">"  "</span> + _postal;<br />                <span class="kwrd">return</span> s;<br />            }<br />        }<br /><br />        <span class="kwrd">public</span> <span class="kwrd">event</span>  PropertyChangedEventHandler PropertyChanged;<br />        <span class="kwrd">protected</span> <span class="kwrd">void</span> onPropertyChanged(<span class="kwrd">string</span> propertyName)<br />        {<br />          <span class="kwrd">if</span> (PropertyChanged != <span class="kwrd">null</span>)<br />                PropertyChanged(<span class="kwrd">this</span>, <span class="kwrd">new</span> PropertyChangedEventArgs(propertyName));<br />        }<br /><br /><br />    }</pre><br /><br />The problem there is that it doesn't provide the edit controls that I like having on such complex data types.  Plus, there is confusion on what action should be performed when the user selects the item.<br /><br />So, I build myself the DataTemplate.  I define that I want all these elements in a specific order, binding as needed. Additionally, since I have the command buttons in the data template, it's DataContext is automatically an instance of my Data Object, so I have a handle to that specific Data Object via the SENDER parameter of my Click Event.<br /><br />The DataTemplate XAML is here:<!-- code formatted by http://manoli.net/csharpformat/ --><br /><pre class="csharpcode"><br /> <span class="kwrd">&lt;</span><span class="html">DataTemplate</span> <span class="attr">x:Key</span><span class="kwrd">="AddressRepeater"</span><span class="kwrd">&gt;</span><br />            <span class="kwrd">&lt;</span><span class="html">DockPanel</span> <span class="attr">HorizontalAlignment</span><span class="kwrd">="Stretch"</span> <span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;</span><span class="html">StackPanel</span> <span class="attr">Height</span><span class="kwrd">="4"</span> <span class="attr">DockPanel</span>.<span class="attr">Dock</span><span class="kwrd">="Top"</span> <span class="attr">HorizontalAlignment</span><span class="kwrd">="Stretch"</span>  <span class="kwrd">&gt;</span><br />                    <span class="kwrd">&lt;</span><span class="html">Separator</span> <span class="attr">BorderBrush</span><span class="kwrd">="Black"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Separator</span><span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;/</span><span class="html">StackPanel</span><span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;</span><span class="html">Border</span> <span class="attr">BorderBrush</span><span class="kwrd">="Black"</span> <span class="attr">BorderThickness</span><span class="kwrd">="1"</span> <span class="attr">CornerRadius</span><span class="kwrd">="0.5"</span> <span class="kwrd">&gt;</span><br />                    <span class="kwrd">&lt;</span><span class="html">StackPanel</span> <span class="attr">DockPanel</span>.<span class="attr">Dock</span><span class="kwrd">="Left"</span> <span class="attr">HorizontalAlignment</span><span class="kwrd">="Left"</span> <br />                                <span class="attr">VerticalAlignment</span><span class="kwrd">="Top"</span> <span class="attr">Orientation</span><span class="kwrd">="Vertical"</span> <span class="kwrd">&gt;</span><br />                        <span class="kwrd">&lt;</span><span class="html">Button</span> <span class="attr">Name</span><span class="kwrd">="cmdEdit"</span> <span class="attr">Style</span><span class="kwrd">="{StaticResource ClearAutoSizeButton}"</span><br />                                <span class="attr">Height</span><span class="kwrd">="20"</span> <span class="attr">Width</span><span class="kwrd">="20"</span> <span class="attr">MaxHeight</span><span class="kwrd">="20"</span> <span class="attr">MaxWidth</span><span class="kwrd">="20"</span><br />                                <span class="attr">MinHeight</span><span class="kwrd">="20"</span> <span class="attr">MinWidth</span><span class="kwrd">="20"</span> <span class="attr">Click</span><span class="kwrd">="cmdEdit_Click"</span><br />                                <span class="attr">HorizontalAlignment</span><span class="kwrd">="Center"</span> <span class="attr">VerticalAlignment</span><span class="kwrd">="Top"</span><br />                                <span class="attr">ToolTip</span><span class="kwrd">="Edit This Address"</span> <span class="attr">Margin</span><span class="kwrd">="5,10,5,10"</span><span class="kwrd">&gt;</span><br />                            <span class="kwrd">&lt;</span><span class="html">Image</span> <span class="attr">Style</span><span class="kwrd">="{DynamicResource EditImage}"</span> <span class="kwrd">/&gt;</span><br />                        <span class="kwrd">&lt;/</span><span class="html">Button</span><span class="kwrd">&gt;</span><br />                        <span class="kwrd">&lt;</span><span class="html">Button</span> <span class="attr">Name</span><span class="kwrd">="cmdDelete"</span> <span class="attr">Style</span><span class="kwrd">="{StaticResource ClearAutoSizeButton}"</span><br />                                <span class="attr">Height</span><span class="kwrd">="20"</span> <span class="attr">Width</span><span class="kwrd">="20"</span> <span class="attr">MaxHeight</span><span class="kwrd">="20"</span> <span class="attr">MaxWidth</span><span class="kwrd">="20"</span><br />                                <span class="attr">MinHeight</span><span class="kwrd">="20"</span> <span class="attr">MinWidth</span><span class="kwrd">="20"</span> <span class="attr">Click</span><span class="kwrd">="cmdDelete_Click"</span> <br />                                <span class="attr">HorizontalAlignment</span><span class="kwrd">="Center"</span> <span class="attr">VerticalAlignment</span><span class="kwrd">="Top"</span><br />                                <span class="attr">ToolTip</span><span class="kwrd">="Delete This Address"</span> <span class="attr">Margin</span><span class="kwrd">="5,0,5,10"</span><span class="kwrd">&gt;</span><br />                            <span class="kwrd">&lt;</span><span class="html">Image</span> <span class="attr">Style</span><span class="kwrd">="{DynamicResource DeleteImage}"</span> <span class="kwrd">/&gt;</span><br />                        <span class="kwrd">&lt;/</span><span class="html">Button</span><span class="kwrd">&gt;</span><br />                    <span class="kwrd">&lt;/</span><span class="html">StackPanel</span><span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;/</span><span class="html">Border</span><span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;</span><span class="html">TextBlock</span> <span class="attr">Text</span><span class="kwrd">="{Binding AddressString}"</span> <span class="attr">TextWrapping</span><span class="kwrd">="Wrap"</span> <span class="attr">Margin</span><span class="kwrd">="10,5,0,0"</span> <span class="kwrd">/&gt;</span><br />            <span class="kwrd">&lt;/</span><span class="html">DockPanel</span><span class="kwrd">&gt;</span><br />        <span class="kwrd">&lt;/</span><span class="html">DataTemplate</span><span class="kwrd">&gt;</span></pre><br /><br />Of course, that alone will give you a very ragged edge, as the controls won't stretch across the window as expected.  Each line will only take up as much room as it needs, no more, no less.  Which does not give you a pretty UI.   To make that DataTemplate stretch across the screen, you've got to add some information to the ListView (or it's style).<br /><br />First, you need to provide the HorizontalContentAlignment value to read "Stretch" Then, you need to set the horizontalAlignment of the ItemContainerStyle to "Stretch" as well.<br /><br />But it's still  not quite right. If your data extends beyond the size of your window, your controls won't wrap as expected (say you're binding to a TextBlock and you expect all the text to be displayed in the control's viewable space).  To fix this, you need to tell the HorizontalScrollbar to be Disabled (which in the Listview is accessed via t he ScrollViewer.HorizontalScrollBarVisibility property).<br /><br />The final prettification that you'll need on the control is if you want alternating background colors.  This takes two steps. The First is to add the AlternationCount to the ListView.   The second is back to the ItemContainerStyle, and you will need to add a Trigger on the ItemsControl.AlternationIndex.   When the Value is 0, give it one color, when it is 1, give it another. Note that you can have as many alternation colors as you'd like. <br /><br />The XAML for the "prettification" is:<!-- code formatted by http://manoli.net/csharpformat/ --><br /><pre class="csharpcode"><br /> <span class="kwrd">&lt;</span><span class="html">ListView</span> <span class="attr">Name</span><span class="kwrd">="lsvAddresses"</span> <span class="attr">MinHeight</span><span class="kwrd">="250"</span> <span class="attr">MinWidth</span><span class="kwrd">="250"</span> <br />                      <span class="attr">HorizontalContentAlignment</span><span class="kwrd">="Stretch"</span> <span class="attr">AlternationCount</span><span class="kwrd">="2"</span><br />                      <span class="attr">ItemTemplate</span><span class="kwrd">="{DynamicResource AddressRepeater}"</span><br />                      <span class="attr">Style</span><span class="kwrd">="{DynamicResource ListViewRepeaterStyle}"</span><br />                      <span class="attr">ScrollViewer</span>.<span class="attr">HorizontalScrollBarVisibility</span><span class="kwrd">="Disabled"</span> <br />                      <span class="attr">SelectionChanged</span><span class="kwrd">="lsvAddresses_SelectionChanged"</span> <br />                              <span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;</span><span class="html">ListView.ItemContainerStyle</span><span class="kwrd">&gt;</span><br />                    <span class="kwrd">&lt;</span><span class="html">Style</span> <span class="attr">TargetType</span><span class="kwrd">="ListBoxItem"</span><span class="kwrd">&gt;</span><br />                        <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="HorizontalAlignment"</span> <span class="attr">Value</span><span class="kwrd">="Stretch"</span><span class="kwrd">/&gt;</span><br />                        <span class="kwrd">&lt;</span><span class="html">Style.Triggers</span><span class="kwrd">&gt;</span><br />                            <span class="kwrd">&lt;</span><span class="html">Trigger</span> <span class="attr">Property</span><span class="kwrd">="ItemsControl.AlternationIndex"</span> <span class="attr">Value</span><span class="kwrd">="0"</span><span class="kwrd">&gt;</span><br />                                <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="Background"</span> <span class="attr">Value</span><span class="kwrd">="#FFFFFC"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span><br />                            <span class="kwrd">&lt;/</span><span class="html">Trigger</span><span class="kwrd">&gt;</span><br />                            <span class="kwrd">&lt;</span><span class="html">Trigger</span> <span class="attr">Property</span><span class="kwrd">="ItemsControl.AlternationIndex"</span> <span class="attr">Value</span><span class="kwrd">="1"</span><span class="kwrd">&gt;</span><br />                                <span class="kwrd">&lt;</span><span class="html">Setter</span> <span class="attr">Property</span><span class="kwrd">="Background"</span> <span class="attr">Value</span><span class="kwrd">="WhiteSmoke"</span><span class="kwrd">&gt;&lt;/</span><span class="html">Setter</span><span class="kwrd">&gt;</span><br />                            <span class="kwrd">&lt;/</span><span class="html">Trigger</span><span class="kwrd">&gt;</span><br />                        <span class="kwrd">&lt;/</span><span class="html">Style.Triggers</span><span class="kwrd">&gt;</span><br />                    <span class="kwrd">&lt;/</span><span class="html">Style</span><span class="kwrd">&gt;</span><br />                <span class="kwrd">&lt;/</span><span class="html">ListView.ItemContainerStyle</span><span class="kwrd">&gt;</span><br />            <span class="kwrd">&lt;/</span><span class="html">ListView</span><span class="kwrd">&gt;</span></pre><br />So, in the end, once we put all these things together, we'll get ourselves a window with a ListView which displays data like this:<br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_0dC8-RtLatg/SnwzS3vHQLI/AAAAAAAAA5o/A-K2zb_rE3o/s1600-h/addresslistapp.png"><img style="margin: 0px auto 10px; display: block; text-align: center; cursor: pointer; width: 300px; height: 300px;" src="http://1.bp.blogspot.com/_0dC8-RtLatg/SnwzS3vHQLI/AAAAAAAAA5o/A-K2zb_rE3o/s320/addresslistapp.png" alt="" id="BLOGGER_PHOTO_ID_5367221255211008178" border="0" /></a><br /><br />And of course, the Source can be downloaded <a href="http://drop.io/oxbtndg/asset/addressmanager-zip" title="addressmanager-zip">here</a>