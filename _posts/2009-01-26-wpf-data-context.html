---
layout: post
title: WPF & The Data Context
date: '2009-01-26T21:33:00.002-06:00'
updated: "2019-03-07 19:46:00"
permalink: "/2009/01/wpf-data-context.html"
author: Stephen Wrighton
tags:
- ".NET"
- programming
- VB.Net
- Coding
- C#
- WPF
- eComic
modified_time: '2009-03-30T16:29:10.306-05:00'
blogger_id: tag:blogger.com,1999:blog-947968907697915479.post-9142556791572085590
blogger_orig_url: https://programmer.wrighton.org/2009/01/wpf-data-context.html
---

I love me some WPF, though I have to admit that when I first started, I did things wrong. I held onto my old-fangled way of doing things as much as possible, and only hesitantly took steps out into the deep waters where the big fish play.<br /><br />Which means it wasn't until I started slapping my head up against the datagrid that I first really looked at the Data Context object.<br /><br />Afterwards, I thoroughly smacked my forehead repeatedly. Imagine it, thousands of lines of code, and a good bit of it can be culled if I had the time or energy to go retrofit it all with Data Contexts.<br /><br />Now, for the uninitiated, a Data Context is just as it says: an object which holds the data that a WPF form uses as a display source for its UI elements.<br /><br />So, looking at the eComic application; every CBR file can potentially have a xml fragment/document within it which contains details about that CBR file. This would contain information such as number of pages, page descriptions, artists, writers, series title, issue title, chapter number, volume number, etc.  All the important meta data, that's truly unimportant to reading an actual issue of a comic.<br /><br />So, what we have is this standard kind of programming structure: UI - Business Logic - Data Store. These three things are supposed to work together, while remaining within their own domains and never quite touching.  Now, the way I had always done this in the past is that either the UI was aware of the Logic layer or the other way around.<br /><br />In my mind, they had to be in order to talk to one another.  It just made sense.<br /><br />Enter the joys of WPF.<br /><br />What happens here is that I have my UI and Data Store as usual. Then I have my business logic, and within it is this Data Context object which holds the data from the data store that I am currently interested in.<br /><br />Taking eComic, let's keep it simple, and only deal with Series Title and Issue Title.<br /><br />What happens is that I'll create a class, which exposes properties for each of those elements.  I can either have the class populate itself, or populate it elsewhere, that's fundamentally irrelevant to the discussion. All we need is the class itself.<br /><br />The next step is that when we're building our UI in XAML, we need to utilize the Binding command.<br /><br />So, if  have a Series Title textbox that I want to display in the UI, I'd have this code:<br /><br /><div style="margin-left: 40px;"><span style="color: rgb(0, 0, 255);"><</span><span style="color: rgb(102, 0, 0);">Textbox </span><span style="color: rgb(255, 0, 0);">Name</span><span style="color: rgb(0, 0, 255);">="SeriesTitle"</span> <span style="color: rgb(255, 0, 0);">Margin</span><span style="color: rgb(0, 0, 255);">="5,5,5,5"</span> <span style="color: rgb(255, 0, 0);">Text</span><span style="color: rgb(0, 0, 255);">="{</span><span style="color: rgb(102, 0, 0);">Binding </span><span style="color: rgb(255, 0, 0);">SeriesTitle</span><span style="color: rgb(0, 0, 255);">}" /></span><br /></div><br />Now, here's where it gets real fun.  All I have to do to get the SeriesTitle from my Data Context to that UI is just assign it to that SeriesTitle's parent container's Data Context. Any changes to the textbox will instantly be promulgated back to the Data Context so I never have to manually check the textbox or any other UI element. All I have to look at is the Data Context.  This is accomplished via the PropertyChanged event, which is brought to us courtesy of the INotifyPropertyChanged interface found in the System.ComponentModel Namespace.<br /><br />So, I'm using the Data Context, and now I have to determine if I need to save changes to the data store based on user input or not.<br /><br />It is important here that I not waste CPU cycles in saving data that hasn't changed. So, this is where the PropertyChanged event really comes into play.<br /><br />First off, since we were smart, we implemented access to the PropertyChanged event via a OnPropertyChanged method which takes in the name of the property being changed.<br /><br />Once the event has been risen, then we would set an IsDirty flag to true. Then, we can check that flag to determine if we need to attempt to save the data or not.<br /><br />This Data Context example can be viewed<a href="http://docs.google.com/Doc?id=dgrd4n99_3414cmbqtf4"> here: </a><br /><br /><div class="csharpcode"><br /><pre class="alt"><span class="lnum">   1:  </span><span class="kwrd">Public</span> <span class="kwrd">Class</span> eComicDataContext</pre><br /><pre><span class="lnum">   2:  </span>       <span class="kwrd">Implements</span> INotifyPropertyChanged</pre><br /><pre class="alt"><span class="lnum">   3:  </span> </pre><br /><pre><span class="lnum">   4:  </span><span class="kwrd">Private</span> _isDirty <span class="kwrd">As</span> <span class="kwrd">Boolean</span></pre><br /><pre class="alt"><span class="lnum">   5:  </span><span class="kwrd">Private</span> _series <span class="kwrd">As</span> <span class="kwrd">String</span></pre><br /><pre><span class="lnum">   6:  </span><span class="kwrd">Private</span> _issue <span class="kwrd">As</span> <span class="kwrd">String</span></pre><br /><pre class="alt"><span class="lnum">   7:  </span> </pre><br /><pre><span class="lnum">   8:  </span><span class="kwrd">Public</span> <span class="kwrd">Sub</span> <span class="kwrd">New</span>()</pre><br /><pre class="alt"><span class="lnum">   9:  </span>       SeriesTitle = <span class="str">""</span></pre><br /><pre><span class="lnum">  10:  </span>       IssueTitle = <span class="str">""</span></pre><br /><pre class="alt"><span class="lnum">  11:  </span>       IsDirty = <span class="kwrd">False</span></pre><br /><pre><span class="lnum">  12:  </span><span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><br /><pre class="alt"><span class="lnum">  13:  </span> </pre><br /><pre><span class="lnum">  14:  </span><span class="kwrd">Public</span> <span class="kwrd">Property</span> SeriesTitle() <span class="kwrd">As</span> <span class="kwrd">String</span></pre><br /><pre class="alt"><span class="lnum">  15:  </span>       <span class="kwrd">Get</span></pre><br /><pre><span class="lnum">  16:  </span>              <span class="kwrd">Return</span> _series</pre><br /><pre class="alt"><span class="lnum">  17:  </span>       <span class="kwrd">End</span> <span class="kwrd">Get</span></pre><br /><pre><span class="lnum">  18:  </span>       <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> <span class="kwrd">String</span>)</pre><br /><pre class="alt"><span class="lnum">  19:  </span>              _series = value</pre><br /><pre><span class="lnum">  20:  </span>              OnPropertyChanged(<span class="str">"SeriesTitle"</span>)</pre><br /><pre class="alt"><span class="lnum">  21:  </span>       <span class="kwrd">End</span> <span class="kwrd">Set</span></pre><br /><pre><span class="lnum">  22:  </span><span class="kwrd">End</span> <span class="kwrd">Property</span></pre><br /><pre class="alt"><span class="lnum">  23:  </span> </pre><br /><pre><span class="lnum">  24:  </span><span class="kwrd">Public</span> <span class="kwrd">Property</span> IssueTitle() <span class="kwrd">As</span> <span class="kwrd">String</span></pre><br /><pre class="alt"><span class="lnum">  25:  </span>       <span class="kwrd">Get</span></pre><br /><pre><span class="lnum">  26:  </span>              <span class="kwrd">Return</span> _series</pre><br /><pre class="alt"><span class="lnum">  27:  </span>       <span class="kwrd">End</span> <span class="kwrd">Get</span></pre><br /><pre><span class="lnum">  28:  </span>       <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> <span class="kwrd">String</span>)</pre><br /><pre class="alt"><span class="lnum">  29:  </span>              _series = value</pre><br /><pre><span class="lnum">  30:  </span>              OnPropertyChanged(<span class="str">"IssueTitle"</span>)</pre><br /><pre class="alt"><span class="lnum">  31:  </span>       <span class="kwrd">End</span> <span class="kwrd">Set</span></pre><br /><pre><span class="lnum">  32:  </span><span class="kwrd">End</span> <span class="kwrd">Property</span></pre><br /><pre class="alt"><span class="lnum">  33:  </span> </pre><br /><pre><span class="lnum">  34:  </span><span class="kwrd">Public</span> <span class="kwrd">Property</span> IsDirty() <span class="kwrd">As</span> <span class="kwrd">Boolean</span></pre><br /><pre class="alt"><span class="lnum">  35:  </span>       <span class="kwrd">Get</span></pre><br /><pre><span class="lnum">  36:  </span>              <span class="kwrd">Return</span> _isDirty</pre><br /><pre class="alt"><span class="lnum">  37:  </span>       <span class="kwrd">End</span> <span class="kwrd">Get</span></pre><br /><pre><span class="lnum">  38:  </span>       <span class="kwrd">Private</span> <span class="kwrd">Set</span>(<span class="kwrd">ByVal</span> value <span class="kwrd">As</span> <span class="kwrd">Boolean</span>)</pre><br /><pre class="alt"><span class="lnum">  39:  </span>              _isDirty = value</pre><br /><pre><span class="lnum">  40:  </span>       <span class="kwrd">End</span> <span class="kwrd">Set</span></pre><br /><pre class="alt"><span class="lnum">  41:  </span><span class="kwrd">End</span> <span class="kwrd">Property</span></pre><br /><pre><span class="lnum">  42:  </span> </pre><br /><pre class="alt"><span class="lnum">  43:  </span><span class="kwrd">Public</span> <span class="kwrd">Sub</span> ResetDirtyBit()</pre><br /><pre><span class="lnum">  44:  </span>       <span class="kwrd">Me</span>.IsDirty = <span class="kwrd">False</span></pre><br /><pre class="alt"><span class="lnum">  45:  </span><span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><br /><pre><span class="lnum">  46:  </span> </pre><br /><pre class="alt"><span class="lnum">  47:  </span><span class="kwrd">Public</span> <span class="kwrd">Sub</span> OnPropertyChanged(<span class="kwrd">ByVal</span> propertyName <span class="kwrd">As</span> <span class="kwrd">String</span>)</pre><br /><pre><span class="lnum">  48:  </span>       <span class="kwrd">RaiseEvent</span> PropertyChanged(<span class="kwrd">Me</span>, <span class="kwrd">New</span> PropertyChangedEventArgs(propertyName))</pre><br /><pre class="alt"><span class="lnum">  49:  </span>       IsDirty = <span class="kwrd">True</span></pre><br /><pre><span class="lnum">  50:  </span><span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><br /><pre class="alt"><span class="lnum">  51:  </span> </pre><br /><pre><span class="lnum">  52:  </span><span class="kwrd">Public</span> <span class="kwrd">Event</span> PropertyChanged(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> <span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> PropertyChangedEventArgs) <span class="kwrd">Implements</span> INotifyPropertyChanged.PropertyChanged</pre><br /><pre class="alt"><span class="lnum">  53:  </span><span class="kwrd">End</span> Class</pre><br /></div>