---
layout: post
title: Using PLUpload with ASP.Net
date: '2018-08-20T20:00:00.000-05:00'
updated: "2019-03-07 19:46:00"
permalink: "/2018/08/using-plupload-with-aspnet.html"
author: Stephen Wrighton
tags:
- ".NET"
- VB.Net
- ASP.Net
- Web
modified_time: '2018-08-20T20:00:03.947-05:00'
blogger_id: tag:blogger.com,1999:blog-947968907697915479.post-4075230224850383048
blogger_orig_url: https://programmer.wrighton.org/2018/08/using-plupload-with-aspnet.html
---

<br /><div style="-en-clipboard: true;">It's a fairly common use case scenario in which one must allow their users to upload files into a web system for various means. Of course, in the situations I find myself, I need to allow this to happen, and I don't necessarily have a maximum size allowed for the file to be processed.&nbsp; It's been a while since I last looked into uploading files, and even then I just used the traditional Input Type='File' control that's a part of the standard suite of HTML4 form elements.</div><div><br /></div><div>Of course I had to push up the number of bytes that were allowed up at any given time, but it was still the simple file upload control.&nbsp;</div><div><br /></div><div>Fast forward a few years, and I knew there had to be a better solution. Or at least I hoped there was.&nbsp;</div><div><br /></div><div>Prayer was involved as well.&nbsp; Just saying.&nbsp;</div><div><br /></div><div>Anyways, I stumbled into a nice deep hole which involved things like chunking, iFrames, Silverlight and Flash movies.</div><div><br /></div><div>With a day of research and writing JavaScript already behind me, I&nbsp; decided that running face first into the brick wall of the exterior of the office would be more productive than continuing the path I was on.&nbsp;&nbsp;</div><div><br /></div><div>So, I started looking for controls.&nbsp;</div><div><br /></div><div>And quickly found the Telerik suite of controls. Of which I wanted just the one. Sadly, they don't sell them that way. To use the Telerik upload control, I would have to buy the other dozen or so controls I did not need, want or would ultimately use.&nbsp; And the DevExpress version was bundled in the exact same way.&nbsp;</div><div><br /></div><div>So, I continued my search.&nbsp;</div><div><br /></div><div>And found PLUpload (<a href="https://www.plupload.com/">https://www.plupload.com/</a>).</div><div><br /></div><div>A quick download, 10 minutes of reading documentation, and then about two hours of coding, I was streaming chunks of data up to my development web server, and into the database. 5 more minutes, I was then generating a link which I could click that would stream those chunks back to me as the image they started life out as.&nbsp;</div><div><br /></div><div>My .ASHX had a fairly straightforward logic built into it, and looked like this:&nbsp;</div><div><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;</span><span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Sub</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">ProcessRequest(</span><span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">ByVal</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">context</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">HttpContext)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Implements</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">IHttpHandler.ProcessRequest</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; context = context</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Request = context.Request</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Response = context.Response</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; sessionId = Request.Cookies(</span><span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">"uploadSessionId"</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">).Value</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Request.Files.Count &gt; 0</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">fileUpload</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">HttpPostedFile = Request.Files(0)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">fileName</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">= fileUpload.FileName</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.IsNullOrWhiteSpace(fileName)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Or</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.Equals(fileName,</span> <span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">"blob"</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fileName =</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">(Request(</span><span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">"name"</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">),</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.Empty)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">'String.IsNullOrWhiteSpace(fileName) Or String.Equals(fileName, "blob")</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">tstr</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">=</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">(Request(</span><span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">"chunks"</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">),</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.Empty)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">chunks</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Integer</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">= -1</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Not</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Integer</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.TryParse(tstr, chunks)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">chunks = -1</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; tstr =</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">(Request(</span><span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">"chunk"</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">),</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.Empty)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">chunk</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Integer</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">= -1</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Not</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Integer</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.TryParse(tstr, chunk)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">chunk = -1</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' If there Then are no chunks sent the file Is sent As one this likely a plain HTML 4 upload (ie. 1 single file)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">chunks = -1</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fileName = IO.Path.GetFileName(fileName)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Not</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">onUploadStart(0, 1, fileName)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Return</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">onUploadChunk(fileUpload.InputStream, 0, 1, fileName)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onUploadComplete(fileName)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteSucessResponse()</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' onUploadChunk(fileUpload.InputStream, chunk, chunks, fileName)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Return</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Else</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' chunks = -1</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">chunk = 0</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Not</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">onUploadStart(chunk, chunks, fileName)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Return</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">onUploadChunk(fileUpload.InputStream, chunk, chunks, fileName)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">chunk &gt;= chunks - 1</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; onUploadComplete(fileName)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' chunk &gt;= chunks - 1</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteSucessResponse()</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' onUploadChunk(fileUpload.InputStream, chunk, chunks, fileName)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Return</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' chunks = -1</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' Request.Files.Count &gt; 0</span></div><div><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Sub</span></div><div><br /></div><div>Basically, I check for something on the FILES upload, and check how many chunks are supposed to be sent for this file, and which chunk this particular file item is.&nbsp; The behavior is slightly different for a file that has a single chunk (if chunks = -1), but the basic steps are:</div><ol><li><div>If the first chunk, do upload start (in this case, create a record in the db indicating a file is upload, and the user its associated with)</div></li><li><div>Save the uploaded chunk somewhere&nbsp;</div></li><li><div>if this is the last chunk, tell the db that all chunks are uploaded</div></li></ol><div><br /></div><div>Then performing the actual file saving aspects, went something like this:</div><div><br /></div><div><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Private</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Function</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">onUploadChunk(fs</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">IO.Stream, chunk</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Integer</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">, numberOfChunks</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Integer</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">, fileName</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Boolean</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">newFileName&nbsp;</span><span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">=</span> <span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">""</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">stream</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">IO.Stream</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Try</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt;">&nbsp;</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">// set newFileName from DB</span></span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Dim</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">uploadFilePath</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">= <a href="http://io.path.combine/">IO.Path.Combine</a>(</span><span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Me</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.fileLocationPath,</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">String</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">.Format(</span><span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">"{0}.{1}"</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">,<span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">newFileName&nbsp;</span>, chunk.ToString(</span><span style="color: #a31515; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">"#000"</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">)))</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">IO.File.Exists(uploadFilePath)</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">IO.File.Delete(uploadFilePath)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; stream =</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">New</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">IO.FileStream(uploadFilePath, IO.FileMode.OpenOrCreate, IO.FileAccess.Write)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fs.CopyTo(stream, 16384)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Catch</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">ex</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">As</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Exception</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: green; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">' Need to set status on this file to bad, as&nbsp; a chunk failed to upload....</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WriteErrorResponse(ex.Message, 100,</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">True</span><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">)</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Return</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">False</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Finally</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">If</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">stream</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">IsNot</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Nothing</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Then</span> <span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">stream.Dispose()</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Try</span></div><div style="min-height: 11pt;"><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Return</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">True</span></div><div><span style="font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">&nbsp;&nbsp;&nbsp;</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">End</span> <span style="color: blue; font-family: &quot;consolas&quot;; font-size: 9pt; min-height: 11pt;">Function</span></div><div><br /></div><div>Again, fairly straightforward code.&nbsp; Though a few thinks, my logic records the file that this is, into the database, that means that the file that I'm saving to the file-system, only has a GUID for a name. Then the chunks are given an extension of which chunk they actually are.&nbsp;</div><div><br /></div><div>Now, I just need to find the best solution for scanning the files as they're uploaded into the network.&nbsp;</div><div><br /></div><div><br /></div><br />