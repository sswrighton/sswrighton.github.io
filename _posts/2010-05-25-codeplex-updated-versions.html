---
layout: post
title: CodePlex & Updated Versions
date: '2010-05-25T19:35:00.001-05:00'
updated: "2019-03-07 19:46:00"
permalink: "/2010/05/codeplex-updated-versions.html"
author: Stephen Wrighton
tags:
- ".NET"
- Codeplex
- Coding
- eComic
- Misc
modified_time: '2010-05-25T19:35:00.711-05:00'
blogger_id: tag:blogger.com,1999:blog-947968907697915479.post-3740309117060310754
blogger_orig_url: https://programmer.wrighton.org/2010/05/codeplex-updated-versions.html
---

CodePlex is Microsoft's Open-Source repository, basically, their gift to the Open Source .NET developers out there.   As such, it has a number of useful and worthwhile features in its code base for said Open Source developers, things such as issue trackers and discussion functions.<br /><br />It's good and I like it.<br /><br />But there is one place where it is lacking, and that's the ability to have the programs "call home" to the project page and make sure that they are the latest version of the software.<br /><br />Ideally, the way this would work, is that we would provide a key on the release page, and when a RESTFUL API was called, that key would be returned. Then a simple compare would do the job.<br /><br />Sadly, that doesn't exist.<br /><br />Even more sadly, I wanted my project to be able to do this.   Basically, my goal is that after the application launches (provided the user wishes for updates to be checked),  the application would call the eComic home page, and found out the key for the current 'recommended' release.  If it was not the "recommended" release, then an icon would be displayed, and when pressed, launch the eComic home page in the browser, ready for downloads.<br /><br />Luckily, I figured out a way around this.<br /><br />Since the site provides an RSS feed detailing project releases, I have a viewpoint into the current release. Or at least, the last release that was edited. The other thing that the site provides is the ability to create "Hidden" releases. Basically, these are releases that you've not finished 100% and thus are not released to the public yet. An important thing to note regarding these hidden releases is that they do not show up in the RSS feed.<br /><br />So, what I did was I created the following settings in my application:<br /><ul><li>Check For Updates (User Setting)</li><li>Current Version (Application Setting)</li><li>Check Update Url (Application Setting)</li></ul>With the <span style="font-weight: bold; font-style: italic;">Check for Updates</span> setting, I will allow the user to turn on/off the ability to perform these checks.  That's just a simple and nice setting that any application that performs these types of checks should implement.<br /><br />The <span style="font-weight: bold; font-style: italic;">Check Update Url</span> is basically a read-only setting, that is the RELEASES RSS feed from the eComic site.<br /><br />Finally, the <span style="font-weight: bold; font-style: italic;">Current Version</span> is a read-only setting, in which I placed the string identifier for this release.<br /><br />After those settings were created, I went and generated a "Hidden" release, and got its <span style="font-weight: bold; font-style: italic;">Release Id</span> from the query string.<br /><br />I then plugged that <span style="font-style: italic; font-weight: bold;">Release Id</span> into the <span style="font-weight: bold; font-style: italic;">Current Version</span> setting.<br /><br />Finally, I had a function which would perform a web request to the eComic RELEASE RSS feed. After grabbing the first item, I perform a simple compare on the associated link to see if the returned link held the <span style="font-weight: bold; font-style: italic;">Current Version</span> value, and displayed my UPDATE icon accordingly.<br /><br />Placing it into a Timer.Elapsed event kept if off my main thread (meaning that the update check would not impact usability) and made it a slight delay from the application launch as well.  The final thing is that the whole kit-n-kaboodle is wrapped in a Try/Catch block as I don't want a failure to connect to the web server to bring down the whole application.<br /><br /><!-- code formatted by http://manoli.net/csharpformat/ --><br /><style type="text/css"><br />.csharpcode, .csharpcode pre<br />{<br /> font-size: small;<br /> color: black;<br /> font-family: Consolas, "Courier New", Courier, Monospace;<br /> background-color: #ffffff;<br /> /*white-space: pre;*/<br />}<br /><br />.csharpcode pre { margin: 0em; }<br /><br />.csharpcode .rem { color: #008000; }<br /><br />.csharpcode .kwrd { color: #0000ff; }<br /><br />.csharpcode .str { color: #006080; }<br /><br />.csharpcode .op { color: #0000c0; }<br /><br />.csharpcode .preproc { color: #cc6633; }<br /><br />.csharpcode .asp { background-color: #ffff00; }<br /><br />.csharpcode .html { color: #800000; }<br /><br />.csharpcode .attr { color: #ff0000; }<br /><br />.csharpcode .alt <br />{<br /> background-color: #f4f4f4;<br /> width: 100%;<br /> margin: 0em;<br />}<br /><br />.csharpcode .lnum { color: #606060; }<br /></style><br /><div class="csharpcode"><br /><pre class="alt"><span class="lnum">   1:  </span> <span class="kwrd">Private</span> <span class="kwrd">Sub</span> _timer_Elapsed(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> <span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> System.Timers.ElapsedEventArgs) <span class="kwrd">Handles</span> _timer.Elapsed</pre><pre><span class="lnum">   2:  </span>        <span class="kwrd">Try</span></pre><pre class="alt"><span class="lnum">   3:  </span>            <span class="kwrd">Dim</span> request <span class="kwrd">As</span> HttpWebRequest = WebRequest.Create(My.Settings.UpdateUrl)</pre><pre><span class="lnum">   4:  </span>            <span class="kwrd">Dim</span> response <span class="kwrd">As</span> HttpWebResponse = request.GetResponse</pre><pre class="alt"><span class="lnum">   5:  </span>            <span class="kwrd">If</span> response.StatusCode = HttpStatusCode.OK <span class="kwrd">Then</span></pre><pre><span class="lnum">   6:  </span>                <span class="kwrd">Dim</span> xDoc <span class="kwrd">As</span> XDocument = XDocument.Load(response.GetResponseStream)</pre><br /><pre class="alt"><span class="lnum">   7:  </span>&nbsp;</pre><pre><span class="lnum">   8:  </span>                _currentVersionUrl = (From xe <span class="kwrd">In</span> xDoc.Descendants(<span class="str">"item"</span>) _</pre><pre class="alt"><span class="lnum">   9:  </span>                                                 <span class="kwrd">Select</span> xe.Element(<span class="str">"link"</span>).Value _</pre><pre><span class="lnum">  10:  </span>                                                 ).Take(1).SingleOrDefault</pre><pre class="alt"><span class="lnum">  11:  </span>                <span class="kwrd">If</span> <span class="kwrd">Not</span> <span class="kwrd">String</span>.IsNullOrEmpty(_currentVersionUrl) <span class="kwrd">Then</span></pre><pre><span class="lnum">  12:  </span>                    <span class="kwrd">If</span> <span class="kwrd">Not</span> _currentVersionUrl.Contains(My.Settings.CurrentRelease) <span class="kwrd">Then</span></pre><pre class="alt"><span class="lnum">  13:  </span>                        <span class="kwrd">Me</span>.DisplayUpdate = <span class="kwrd">True</span></pre><pre><span class="lnum">  14:  </span>                    <span class="kwrd">End</span> <span class="kwrd">If</span></pre><pre class="alt"><span class="lnum">  15:  </span>                <span class="kwrd">End</span> <span class="kwrd">If</span></pre><pre><span class="lnum">  16:  </span>            <span class="kwrd">End</span> <span class="kwrd">If</span></pre><pre class="alt"><span class="lnum">  17:  </span>&nbsp;</pre><pre><span class="lnum">  18:  </span>            <span class="rem">' Check to ensure the link is a VALID url </span></pre><pre class="alt"><span class="lnum">  19:  </span>            <span class="kwrd">If</span> <span class="kwrd">Me</span>.DisplayUpdate <span class="kwrd">Then</span></pre><pre><span class="lnum">  20:  </span>                <span class="kwrd">Dim</span> re2 <span class="kwrd">As</span> HttpWebRequest = WebRequest.Create(<span class="kwrd">Me</span>._currentVersionUrl)</pre><pre class="alt"><span class="lnum">  21:  </span>                re2.AllowAutoRedirect = <span class="kwrd">False</span></pre><pre><span class="lnum">  22:  </span>                re2.Method = <span class="str">"Head"</span></pre><pre class="alt"><span class="lnum">  23:  </span>                re2.KeepAlive = <span class="kwrd">False</span></pre><pre><span class="lnum">  24:  </span>                <span class="kwrd">Dim</span> res <span class="kwrd">As</span> HttpWebResponse = request.GetResponse</pre><pre class="alt"><span class="lnum">  25:  </span>                <span class="kwrd">If</span> <span class="kwrd">Not</span> res.StatusCode = HttpStatusCode.OK <span class="kwrd">Then</span> <span class="kwrd">Me</span>.DisplayUpdate = <span class="kwrd">False</span></pre><pre><span class="lnum">  26:  </span>            <span class="kwrd">End</span> <span class="kwrd">If</span> <span class="rem">' Me.DisplayUpdate </span></pre><pre class="alt"><span class="lnum">  27:  </span>&nbsp;</pre><pre><span class="lnum">  28:  </span>&nbsp;</pre><pre class="alt"><span class="lnum">  29:  </span>        <span class="kwrd">Catch</span> ex <span class="kwrd">As</span> Exception</pre><pre><span class="lnum">  30:  </span>            <span class="rem">' Do Nothing.  If this fails, then I'm not concerned, as I'll just continue happily with the current version </span></pre><pre class="alt"><span class="lnum">  31:  </span>        <span class="kwrd">End</span> <span class="kwrd">Try</span></pre><pre><span class="lnum">  32:  </span>    <span class="kwrd">End</span> Sub</pre><br /></div>